(()=>{var W=Object.create;var x=Object.defineProperty;var J=Object.getOwnPropertyDescriptor;var Q=Object.getOwnPropertyNames;var G=Object.getPrototypeOf,Y=Object.prototype.hasOwnProperty;var g=(t,o)=>()=>(t&&(o=t(t=0)),o);var P=(t,o)=>()=>(o||t((o={exports:{}}).exports,o),o.exports),Z=(t,o)=>{for(var e in o)x(t,e,{get:o[e],enumerable:!0})},K=(t,o,e,a)=>{if(o&&typeof o=="object"||typeof o=="function")for(let n of Q(o))!Y.call(t,n)&&n!==e&&x(t,n,{get:()=>o[n],enumerable:!(a=J(o,n))||a.enumerable});return t};var F=(t,o,e)=>(e=t!=null?W(G(t)):{},K(o||!t||!t.__esModule?x(e,"default",{value:t,enumerable:!0}):e,t));var I={};Z(I,{renderResults:()=>p});function V(t){if(!t)return"";if(/^[A-Z][a-z]+ \d{4}$/.test(t))return t;try{let e=new Date(t);if(!isNaN(e.getTime()))return`${["January","February","March","April","May","June","July","August","September","October","November","December"][e.getMonth()]} ${e.getFullYear()}`}catch{}return t}function X(t){if(!t.title||!t.summary||!t.liveUrl)return console.warn("Skipping card with missing required fields:",t),null;let o=document.createElement("div");o.className="aikb-search-card";let e=document.createElement("div");e.className="aikb-search-card__inner";let a=document.createElement("div");a.className="aikb-search-card__content";let n=document.createElement("div");n.className="aikb-search-card__text";let r=document.createElement("h3");r.className="aikb-search-card__title",r.textContent=t.title,n.appendChild(r);let l=document.createElement("p");l.className="aikb-search-card__summary",l.textContent=t.summary,n.appendChild(l),a.appendChild(n);let i=t.listMetadata&&t.listMetadata.keyword?t.listMetadata.keyword[0]:null;if(i){let u=document.createElement("div");u.className="aikb-search-card__tags",i.split(",").forEach(b=>{let N=b.trim();if(N){let _=document.createElement("div");_.className="aikb-search-card__tag",_.textContent=N,u.appendChild(_)}}),a.appendChild(u)}e.appendChild(a);let d=document.createElement("div");d.className="aikb-search-card__actions";let f=document.createElement("a");f.href=t.liveUrl,f.className="ntgc-btn ntgc-btn--secondary";let h=document.createElement("span");h.textContent="See more",f.appendChild(h);let m=document.createElement("span");m.className="fal fa-long-arrow-right",m.setAttribute("aria-hidden","true"),f.appendChild(m),d.appendChild(f);let c=document.createElement("div");c.className="aikb-search-card__metadata";let T=t.listMetadata&&t.listMetadata.keyword?t.listMetadata.keyword[1]:null;if(T){let u=document.createElement("div");u.className="aikb-search-card__useful-for";let A=document.createElement("span");A.className="aikb-search-card__useful-label",A.textContent="Useful for: ",u.appendChild(A);let b=document.createElement("span");b.className="aikb-search-card__useful-value",b.textContent=T,u.appendChild(b),c.appendChild(u)}if(t.date){let u=document.createElement("div");u.className="aikb-search-card__date",u.textContent=`Submitted: ${V(t.date)}`,c.appendChild(u)}return d.appendChild(c),e.appendChild(d),o.appendChild(e),o}function p(t,o="search-results-list"){console.log(`renderResults called with ${t.length} results for container #${o}`);let e=document.getElementById(o);if(console.log(`document.getElementById("${o}"):`,e),!e){let n=window.$?window.$(`#${o}`):null;console.log(`jQuery selector $("#${o}"):`,n),e=n&&n.length>0?n[0]:null}if(!e){console.error(`Container #${o} not found`),console.log("Available elements with id:",Array.from(document.querySelectorAll("[id]")).map(n=>n.id));return}e.innerHTML="";let a=t.map(n=>X(n)).filter(n=>n!==null);if(a.length===0){let n=document.createElement("p");n.textContent="No results found.",n.style.padding="24px 48px",e.appendChild(n);return}a.forEach(n=>e.appendChild(n)),console.log(`Rendered ${a.length} search result cards`)}var w=g(()=>{window.aikbRenderResults=p});function ee(t){let o=new Set;return t.forEach(e=>{e.listMetadata&&e.listMetadata.keyword&&e.listMetadata.keyword[0]&&e.listMetadata.keyword[0].split(",").forEach(n=>{let r=n.trim();r&&o.add(r)})}),Array.from(o).sort((e,a)=>e==="All work areas"?-1:a==="All work areas"?1:e.localeCompare(a))}function te(t){let o=document.getElementById("document_type");if(!o){console.warn("Work area dropdown #document_type not found");return}o.innerHTML="";let e=document.createElement("option");e.value="",e.textContent="Select a work area",e.disabled=!0,e.selected=!0,o.appendChild(e),t.forEach(a=>{let n=document.createElement("option");n.value=a,n.textContent=a,o.appendChild(n)}),console.log(`Populated work area dropdown with ${t.length} options`)}function ne(){let t=document.getElementById("owner");if(!t){console.warn("Sort dropdown #owner not found");return}t.innerHTML="";let o=[{value:"",label:"Sort by...",disabled:!0,selected:!0},{value:"relevance",label:"Relevance"},{value:"date-newest",label:"Date (newest first)"},{value:"date-oldest",label:"Date (oldest first)"},{value:"title-az",label:"Title (A-Z)"},{value:"title-za",label:"Title (Z-A)"}];o.forEach(e=>{let a=document.createElement("option");a.value=e.value,a.textContent=e.label,e.disabled&&(a.disabled=!0),e.selected&&(a.selected=!0),t.appendChild(a)}),console.log(`Populated sort dropdown with ${o.length-1} options`)}function oe(){let t=document.getElementById("document_type");if(t&&!t.parentElement.querySelector(".aikb-dropdown-icon")){let e=document.createElement("div");e.className="aikb-dropdown-icon",e.setAttribute("data-colour","NTG Blue"),e.innerHTML='<span class="fal fa-chevron-down" aria-hidden="true"></span>';let a=t.closest(".aikb-dropdown-wrapper");if(a){let n=a.querySelector(".aikb-dropdown-inner");n&&n.appendChild(e)}}let o=document.getElementById("owner");if(o&&!o.parentElement.querySelector(".aikb-dropdown-icon")){let e=document.createElement("div");e.className="aikb-dropdown-icon",e.setAttribute("data-colour","NTG Blue"),e.innerHTML='<span class="fal fa-chevron-down" aria-hidden="true"></span>';let a=o.closest(".aikb-dropdown-wrapper");if(a){let n=a.querySelector(".aikb-dropdown-inner");n&&n.appendChild(e)}}}function k(t){console.log("Initializing dropdowns with search data...");let o=ee(t);te(o),ne(),oe(),console.log("Dropdowns initialized successfully")}var v=g(()=>{});function y(t){C=t,console.log(`Stored ${C.length} results for filtering/sorting`)}function ae(t){return!t||t===""?C:C.filter(o=>!o.listMetadata||!o.listMetadata.keyword||!o.listMetadata.keyword[0]?!1:o.listMetadata.keyword[0].split(",").map(n=>n.trim()).includes(t))}function re(t,o){let e=[...t];switch(o){case"relevance":e.sort((a,n)=>a.rank&&n.rank?a.rank-n.rank:a.score&&n.score?n.score-a.score:0);break;case"date-newest":e.sort((a,n)=>{let r=a.date?new Date(a.date).getTime():0;return(n.date?new Date(n.date).getTime():0)-r});break;case"date-oldest":e.sort((a,n)=>{let r=a.date?new Date(a.date).getTime():0,l=n.date?new Date(n.date).getTime():0;return r-l});break;case"title-az":e.sort((a,n)=>{let r=a.title||"",l=n.title||"";return r.localeCompare(l)});break;case"title-za":e.sort((a,n)=>{let r=a.title||"";return(n.title||"").localeCompare(r)});break;default:break}return e}async function L(){let t=document.getElementById("document_type"),o=document.getElementById("owner");if(!t||!o){console.warn("Filter/sort dropdowns not found");return}let e=t.value,a=o.value||"relevance";console.log(`Applying filters - Work Area: "${e}", Sort: "${a}"`);let n=ae(e);console.log(`After filtering: ${n.length} results`);let r=re(n,a);console.log(`After sorting: ${r.length} results`);let{renderResults:l}=await Promise.resolve().then(()=>(w(),I));l(r,"search-results-list")}function S(){let t=document.getElementById("document_type"),o=document.getElementById("owner");t&&t.addEventListener("change",function(){console.log(`Work area filter changed to: ${this.value}`),L()}),o&&o.addEventListener("change",function(){console.log(`Sort changed to: ${this.value}`),L()}),console.log("Filter and sort listeners initialized")}var C,E=g(()=>{C=[]});var s,z=g(()=>{w();v();E();s={originalterm:"",filteredterm:"",currentPage:1,defaults:{sourceField:"#search",baseURL:"https://ntgov-search.funnelback.squiz.cloud/s/search.json",collection:"ntgov~sp-ntgc-ai-knowledge-base",defaultQuery:"!FunDoesNotExist:PadreNull",funnelbackParams:{},minChars:3,containerSelector:"#content .inner-page.au-body .container"},noisewords:"a au all am an and any are as at be been but by can cant co com de do eg else etc for from get go had has hasnt have he hence her here hers him his how http https i ie if in is it its la me my nor not now of off on or our ours pm put re she so than that the their them then there these they this those thus to too uk un until up upon us very via was we well were what when where which while who why www you your yours",init:function(t,o,e,a,n=!1){console.log("Init Funnelback Search");let r=new RegExp("[*<>();/&]","gi");t=t.replace(r,""),t!==!1&&t.trim().length>0&&(s.originalterm=t,s.currentPage=1,s.callSearchAPI())},callSearchAPI:function(t,o){t!=null&&(s.originalterm=t),console.log("callSearchAPI called with originalterm:",s.originalterm);let e=document.getElementById("search-results-list");e&&(e.innerHTML='<div class="aikb-loading">Searching...</div>'),s.filterQuery(),console.log("After filterQuery, filteredterm:",s.filteredterm);let a=(s.currentPage-1)*10+1,n=`${s.defaults.baseURL}?collection=${s.defaults.collection}`;if(s.filteredterm&&s.filteredterm.trim().length>0){n+=`&query=${encodeURIComponent(s.filteredterm)}`;let r=new URLSearchParams(window.location.search);r.set("query",s.filteredterm),s.currentPage&&s.currentPage!==1?r.set("page",s.currentPage):r.delete("page");let l=window.location.pathname+(r.toString()?"?"+r.toString():"");window.history.replaceState({},"",l)}else n+=`&s=${encodeURIComponent(s.defaults.defaultQuery)}`;n+=`&num_ranks=10&start_rank=${a}`,console.log("Calling Funnelback API:",n),$.ajax({url:n,dataType:"JSON",type:"GET",success:function(r){s.processResults(r)},error:function(r,l,i){console.warn("Funnelback API error, loading fallback data:",i),$.ajax({url:"src/data/search.json",dataType:"JSON",type:"GET",success:function(d){console.log("Loaded fallback search data"),s.processResults(d)},error:function(){console.error("Failed to load fallback search data"),typeof o=="function"?(console.log("Triggering offline search fallback"),o(new Error("Both API and fallback JSON failed"))):e&&(e.innerHTML="<p>Unable to load search results. Please try again later.</p>")}})}})},filterQuery:function(){if(!s.originalterm||s.originalterm.trim()==="")return s.filteredterm="",!1;let t=s.noisewords.split(" "),o=s.originalterm.trim().split(" ");if(o.length===0)return s.filteredterm="",!1;let e=[];$.each(o,function(r,l){$.inArray(l.toLowerCase(),t)===-1&&e.push(l)});let a=new RegExp("[*<>{}();/&]","gi"),n=e.join(" ");n=n.replace(a,""),s.filteredterm=n},processResults:function(t){let o=t.response&&t.response.resultPacket?t.response.resultPacket.results:[];console.log(`Processing ${o.length} search results`);let e=["https://ntgcentral.nt.gov.au/dev/aikb/configuration/listing/articles/_nocache"],a=o.filter(r=>!e.includes(r.liveUrl));console.log(`After filtering: ${a.length} results (excluded ${o.length-a.length})`);let n=a.map(r=>({title:r.title||"",summary:r.summary||"",listMetadata:r.listMetadata||{},date:r.date||"",liveUrl:r.liveUrl||"",rank:r.rank||0,score:r.score||0}));y(n),k(n),S(),p(n,"search-results-list"),console.log("Search results rendered successfully")}};window.ntgFunnelback=s});var U=P(()=>{var le='div[data-hydration-component="squiz-call-to-action"] a';function B(t=document){t.querySelectorAll(le).forEach(e=>{e.classList.add("ntgc-btn","ntgc-btn--primary")})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>B()):B()});function R(){let t=document.getElementById("search-results-list");if(!t){console.warn("search-results-list container not found on page");return}console.log("Loading initial results (fallback first, then API)..."),fetch("src/data/search.json").then(e=>{if(console.log("Fallback JSON response status:",e.status,e.ok),!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}).then(e=>{console.log("Fallback JSON data loaded successfully:",e),O(e,"fallback")}).catch(e=>{console.error("Error loading fallback search.json:",e),t.innerHTML='<p class="aikb-error">Error loading search data: '+e.message+"</p>"}),fetch("https://ntgov-search.funnelback.squiz.cloud/s/search.json?collection=ntgov~sp-ntgc-ai-knowledge-base&s=!FunDoesNotExist:PadreNull").then(e=>{if(console.log("Funnelback API response status:",e.status,e.ok),!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}).then(e=>{console.log("Funnelback API data loaded successfully, updating results:",e),O(e,"api")}).catch(e=>{console.warn("Funnelback API failed or timed out, keeping fallback data:",e)})}function O(t,o="unknown"){let a=(t.response&&t.response.resultPacket?t.response.resultPacket.results:[]).map(n=>({title:n.title||"",summary:n.summary||"",listMetadata:n.listMetadata||{},date:n.date?new Date(n.date).toLocaleDateString("en-AU",{year:"numeric",month:"long"}):"",liveUrl:n.liveUrl||"",rank:n.rank||0,score:n.score||0}));console.log(`Rendering ${a.length} cards from ${o}`),y(a),window.aikbSearchCache=a,console.log(`Cached ${a.length} results for offline search`),k(a),o==="fallback"&&S(),p(a,"search-results-list")}var D=g(()=>{w();v();E();window.addEventListener("load",function(){console.log("Page load event fired, loading initial results..."),setTimeout(R,200)})});function j(t,o){if(!t||!o||o.length===0)return console.log("Offline search: No keywords or no cached results available"),[];let e=t.toLowerCase().replace(/[^\w\s]/g,"").trim();if(!e)return console.log("Offline search: Keywords empty after normalization"),[];console.log(`Offline search: Searching for "${t}" in ${o.length} cached results`);let a=new RegExp(e,"gi"),r=o.map(l=>{let i=0,d=0,f=0,h=0;if(l.title){let c=l.title.toLowerCase().replace(/[^\w\s]/g,"").match(a);c&&(d=c.length,i+=d*3)}if(l.summary){let c=l.summary.toLowerCase().replace(/[^\w\s]/g,"").match(a);c&&(f=c.length,i+=f*1)}if(l.metadata){let c=l.metadata.toLowerCase().replace(/[^\w\s]/g,"").match(a);c&&(h=c.length,i+=h*2)}return{...l,_offlineScore:i,_offlineMatches:{title:d,summary:f,metadata:h}}}).filter(l=>l._offlineScore>0);return r.sort((l,i)=>i._offlineScore-l._offlineScore),console.log(`Offline search: Found ${r.length} results matching "${t}"`),r.length>0&&(console.log("Offline search: Top results:"),r.slice(0,3).forEach((l,i)=>{console.log(`  ${i+1}. "${l.title}" (score: ${l._offlineScore}, title:${l._offlineMatches.title}, summary:${l._offlineMatches.summary}, metadata:${l._offlineMatches.metadata})`)})),r}function q(){return window.aikbSearchCache&&Array.isArray(window.aikbSearchCache)?(console.log(`Offline search: Retrieved ${window.aikbSearchCache.length} cached results`),window.aikbSearchCache):(console.log("Offline search: No cached data available"),null)}var M=g(()=>{});var H=P(()=>{D();w();M();E();v();(function(){if(typeof window.$>"u"){console.warn("jQuery not loaded; search form handler disabled");return}let o=window.$("#policy-search-form"),e=window.$("#search");if(o.length===0){console.error("Form #policy-search-form not found");return}function a(){return{query:e.val()||"",area:window.$("#document_type").val()||""}}function n(l){l.preventDefault();let i=a();if(!i.query.trim()){console.log("Empty search - reloading initial results"),R();return}let d=window.$("#search-results-list");d.length>0&&d.html('<div class="aikb-loading">Searching...</div>'),window.ntgFunnelback&&typeof window.ntgFunnelback.callSearchAPI=="function"?(window.ntgFunnelback.originalterm=i.query,window.ntgFunnelback.currentPage=1,window.ntgFunnelback.callSearchAPI(i.query,function(f){console.log("Activating offline search mode");let h=q();if(!h||h.length===0){console.error("Offline search: No cached data available");let c=window.$("#search-results-list");c.length>0&&c.html('<p class="aikb-error">Unable to load search results. Please check your connection and try again.</p>');return}let m=j(i.query,h);y(m),k(m),p(m,"search-results-list"),console.log(`Offline search: Displayed ${m.length} results`)})):console.error("Funnelback API not initialized")}function r(){e.val(""),console.log("Search cleared - reloading initial results"),R()}o.on("submit",n),window.$("#clear-input").on("click",r),e.on("input",function(){let l=window.$("#clear-input");window.$(this).val().length>0?l.attr("hidden",!1):l.attr("hidden","")}),console.log("Search form handler initialized")})()});var se=P(()=>{z();var Pe=F(U());w();var Me=F(H());D();v();E();M()});se();})();
//# sourceMappingURL=aikb_scripts.min.js.map
