(()=>{var G=Object.create;var N=Object.defineProperty;var K=Object.getOwnPropertyDescriptor;var Y=Object.getOwnPropertyNames;var Z=Object.getPrototypeOf,X=Object.prototype.hasOwnProperty;var f=(n,t)=>()=>(n&&(t=n(n=0)),t);var L=(n,t)=>()=>(t||n((t={exports:{}}).exports,t),t.exports),ee=(n,t)=>{for(var e in t)N(n,e,{get:t[e],enumerable:!0})},te=(n,t,e,l)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of Y(t))!X.call(n,a)&&a!==e&&N(n,a,{get:()=>t[a],enumerable:!(l=K(t,a))||l.enumerable});return n};var F=(n,t,e)=>(e=n!=null?G(Z(n)):{},te(t||!n||!n.__esModule?N(e,"default",{value:n,enumerable:!0}):e,n));var O={};ee(O,{renderResults:()=>p});function ne(n){if(!n)return"";if(/^[A-Z][a-z]+ \d{4}$/.test(n))return n;try{let e=new Date(n);if(!isNaN(e.getTime()))return`${["January","February","March","April","May","June","July","August","September","October","November","December"][e.getMonth()]} ${e.getFullYear()}`}catch{}return n}function ae(n){if(!n.title||!n.summary||!n.liveUrl)return console.warn("Skipping card with missing required fields:",n),null;let t=document.createElement("div");t.className="aikb-search-card";let e=document.createElement("div");e.className="aikb-search-card__inner";let l=document.createElement("div");l.className="aikb-search-card__content";let a=document.createElement("div");a.className="aikb-search-card__text";let o=document.createElement("h3");o.className="aikb-search-card__title",o.textContent=n.title,a.appendChild(o);let s=document.createElement("p");s.className="aikb-search-card__summary",s.textContent=n.summary,a.appendChild(s),l.appendChild(a);let r=n.listMetadata&&n.listMetadata.keyword?n.listMetadata.keyword[0]:null;if(r){let h=document.createElement("div");h.className="aikb-search-card__tags",r.split(",").forEach(y=>{let B=y.trim();if(B){let _=document.createElement("div");_.className="aikb-search-card__tag",_.textContent=B,h.appendChild(_)}}),l.appendChild(h)}e.appendChild(l);let d=document.createElement("div");d.className="aikb-search-card__actions";let c=document.createElement("a");c.href=n.liveUrl,c.className="ntgc-btn ntgc-btn--secondary";let m=document.createElement("span");m.textContent="See more",c.appendChild(m);let g=document.createElement("span");g.className="fal fa-long-arrow-right",g.setAttribute("aria-hidden","true"),c.appendChild(g),d.appendChild(c);let u=document.createElement("div");u.className="aikb-search-card__metadata";let D=n.listMetadata&&n.listMetadata.keyword?n.listMetadata.keyword[1]:null;if(D){let h=document.createElement("div");h.className="aikb-search-card__useful-for";let C=document.createElement("span");C.className="aikb-search-card__useful-label",C.textContent="Useful for: ",h.appendChild(C);let y=document.createElement("span");y.className="aikb-search-card__useful-value",y.textContent=D,h.appendChild(y),u.appendChild(h)}if(n.date){let h=document.createElement("div");h.className="aikb-search-card__date",h.textContent=`Submitted: ${ne(n.date)}`,u.appendChild(h)}return d.appendChild(u),e.appendChild(d),t.appendChild(e),t}function p(n,t="search-results-list"){console.log(`renderResults called with ${n.length} results for container #${t}`);let e=document.getElementById(t);if(console.log(`document.getElementById("${t}"):`,e),!e){let a=window.$?window.$(`#${t}`):null;console.log(`jQuery selector $("#${t}"):`,a),e=a&&a.length>0?a[0]:null}if(!e){console.error(`Container #${t} not found`),console.log("Available elements with id:",Array.from(document.querySelectorAll("[id]")).map(a=>a.id));return}e.innerHTML="";let l=n.map(a=>ae(a)).filter(a=>a!==null);if(l.length===0){let a=document.createElement("p");a.textContent="No results found.",a.style.padding="24px 48px",e.appendChild(a);return}l.forEach(a=>e.appendChild(a)),console.log(`Rendered ${l.length} search result cards`)}var w=f(()=>{window.aikbRenderResults=p});function z(n){let t=typeof n=="string"?document.querySelector(n):n;return t?new R(t):(console.warn("Multi-select element not found:",n),null)}var R,M=f(()=>{R=class{constructor(t){this.selectElement=t,this.options=[],this.selectedValues=new Set,this.tempSelectedValues=new Set,this.isOpen=!1,this.container=null,this.displayButton=null,this.dropdownPanel=null,this.init()}init(){this.selectElement.style.display="none",this.createDropdownStructure(),this.bindEvents(),this.container.__multiSelectInstance=this}createDropdownStructure(){this.container=document.createElement("div"),this.container.className="aikb-multiselect-container",this.displayButton=document.createElement("button"),this.displayButton.type="button",this.displayButton.className="aikb-multiselect-button",this.displayButton.innerHTML=`
      <span class="aikb-multiselect-text">Select Options</span>
      <span class="aikb-multiselect-icon">
        <i class="fal fa-chevron-down" aria-hidden="true"></i>
      </span>
    `,this.dropdownPanel=document.createElement("div"),this.dropdownPanel.className="aikb-multiselect-panel",this.dropdownPanel.style.display="none";let t=document.createElement("div");t.className="aikb-multiselect-options";let e=this.createOptionItem({value:"_select_all",label:"Select All",isSelectAll:!0});t.appendChild(e),Array.from(this.selectElement.options).forEach(s=>{if(!s.disabled&&s.value){this.options.push({value:s.value,label:s.textContent});let r=this.createOptionItem({value:s.value,label:s.textContent});t.appendChild(r)}});let l=document.createElement("div");l.className="aikb-multiselect-actions";let a=document.createElement("button");a.type="button",a.className="aikb-multiselect-btn aikb-multiselect-btn-ok",a.textContent="OK",a.addEventListener("click",()=>this.handleOk());let o=document.createElement("button");o.type="button",o.className="aikb-multiselect-btn aikb-multiselect-btn-cancel",o.textContent="Cancel",o.addEventListener("click",()=>this.handleCancel()),l.appendChild(a),l.appendChild(o),this.dropdownPanel.appendChild(t),this.dropdownPanel.appendChild(l),this.container.appendChild(this.displayButton),this.container.appendChild(this.dropdownPanel),this.selectElement.parentNode.insertBefore(this.container,this.selectElement.nextSibling)}createOptionItem(t){let e=document.createElement("label");e.className="aikb-multiselect-option",t.isSelectAll&&e.classList.add("aikb-multiselect-option-all");let l=document.createElement("input");l.type="checkbox",l.className="aikb-multiselect-checkbox",l.value=t.value,l.dataset.label=t.label,t.isSelectAll?l.addEventListener("change",o=>this.handleSelectAll(o)):l.addEventListener("change",()=>this.updateSelectAllState());let a=document.createElement("span");return a.className="aikb-multiselect-label",a.textContent=t.label,e.appendChild(l),e.appendChild(a),e}bindEvents(){this.displayButton.addEventListener("click",t=>{t.stopPropagation(),this.toggle()}),document.addEventListener("click",t=>{!this.container.contains(t.target)&&this.isOpen&&this.handleCancel()})}toggle(){this.isOpen?this.close():this.open()}open(){this.isOpen=!0,this.dropdownPanel.style.display="block",this.displayButton.classList.add("aikb-multiselect-open"),this.tempSelectedValues=new Set(this.selectedValues),this.updateCheckboxes()}close(){this.isOpen=!1,this.dropdownPanel.style.display="none",this.displayButton.classList.remove("aikb-multiselect-open")}handleOk(){let t=this.dropdownPanel.querySelectorAll('.aikb-multiselect-checkbox:not([value="_select_all"])');this.selectedValues.clear(),t.forEach(e=>{e.checked&&this.selectedValues.add(e.value)}),this.updateDisplayText(),this.triggerChange(),this.close()}handleCancel(){this.tempSelectedValues=new Set(this.selectedValues),this.updateCheckboxes(),this.close()}handleSelectAll(t){let e=t.target.checked;this.dropdownPanel.querySelectorAll('.aikb-multiselect-checkbox:not([value="_select_all"])').forEach(a=>{a.checked=e})}updateSelectAllState(){let t=this.dropdownPanel.querySelector('.aikb-multiselect-checkbox[value="_select_all"]'),e=this.dropdownPanel.querySelectorAll('.aikb-multiselect-checkbox:not([value="_select_all"])'),l=Array.from(e).filter(a=>a.checked).length;t&&(t.checked=l===e.length,t.indeterminate=l>0&&l<e.length)}updateCheckboxes(){this.dropdownPanel.querySelectorAll('.aikb-multiselect-checkbox:not([value="_select_all"])').forEach(e=>{e.checked=this.tempSelectedValues.has(e.value)}),this.updateSelectAllState()}updateDisplayText(){let t=this.displayButton.querySelector(".aikb-multiselect-text");if(this.selectedValues.size===0)t.textContent="Select Options",t.classList.remove("aikb-multiselect-has-selection");else if(this.selectedValues.size===this.options.length)t.textContent="All selected",t.classList.add("aikb-multiselect-has-selection");else{let e=Array.from(this.selectedValues).map(l=>{let a=this.options.find(o=>o.value===l);return a?a.label:l});this.selectedValues.size<=2?t.textContent=e.join(", "):t.textContent=`${this.selectedValues.size} selected`,t.classList.add("aikb-multiselect-has-selection")}}triggerChange(){let t=new CustomEvent("multiselect-change",{detail:{values:Array.from(this.selectedValues)}});this.container.dispatchEvent(t),console.log("Multi-select changed:",Array.from(this.selectedValues))}getSelectedValues(){return Array.from(this.selectedValues)}reset(){this.selectedValues.clear(),this.tempSelectedValues.clear(),this.updateDisplayText(),this.updateCheckboxes()}destroy(){this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.selectElement&&(this.selectElement.style.display=""),this.container=null,this.displayButton=null,this.dropdownPanel=null,console.log("Multi-select instance destroyed")}}});function le(n){let t=new Set;return n.forEach(e=>{e.listMetadata&&e.listMetadata.keyword&&e.listMetadata.keyword[0]&&e.listMetadata.keyword[0].split(",").forEach(a=>{let o=a.trim();o&&t.add(o)})}),Array.from(t).sort((e,l)=>e==="All work areas"?-1:l==="All work areas"?1:e.localeCompare(l))}function oe(n){let t=document.getElementById("document_type");if(!t){console.warn("Work area dropdown #document_type not found");return}t.innerHTML="";let e=document.createElement("option");e.value="",e.textContent="Select a work area",e.disabled=!0,e.selected=!0,t.appendChild(e),n.forEach(l=>{let a=document.createElement("option");a.value=l,a.textContent=l,t.appendChild(a)}),console.log(`Populated work area dropdown with ${n.length} options`),E&&(E.destroy(),E=null),(!t.nextElementSibling||!t.nextElementSibling.classList.contains("aikb-multiselect-container"))&&(E=z(t))}function se(){let n=document.getElementById("owner");if(!n){console.warn("Sort dropdown #owner not found");return}n.innerHTML="";let t=[{value:"",label:"Sort by...",disabled:!0,selected:!0},{value:"relevance",label:"Relevance"},{value:"date-newest",label:"Date (newest first)"},{value:"date-oldest",label:"Date (oldest first)"},{value:"title-az",label:"Title (A-Z)"},{value:"title-za",label:"Title (Z-A)"}];t.forEach(e=>{let l=document.createElement("option");l.value=e.value,l.textContent=e.label,e.disabled&&(l.disabled=!0),e.selected&&(l.selected=!0),n.appendChild(l)}),console.log(`Populated sort dropdown with ${t.length-1} options`)}function ie(){let n=document.getElementById("document_type");if(n&&!n.parentElement.querySelector(".aikb-dropdown-icon")){let e=document.createElement("div");e.className="aikb-dropdown-icon",e.setAttribute("data-colour","NTG Blue"),e.innerHTML='<span class="fal fa-chevron-down" aria-hidden="true"></span>';let l=n.closest(".aikb-dropdown-wrapper");if(l){let a=l.querySelector(".aikb-dropdown-inner");a&&a.appendChild(e)}}let t=document.getElementById("owner");if(t&&!t.parentElement.querySelector(".aikb-dropdown-icon")){let e=document.createElement("div");e.className="aikb-dropdown-icon",e.setAttribute("data-colour","NTG Blue"),e.innerHTML='<span class="fal fa-chevron-down" aria-hidden="true"></span>';let l=t.closest(".aikb-dropdown-wrapper");if(l){let a=l.querySelector(".aikb-dropdown-inner");a&&a.appendChild(e)}}}function b(n){console.log("Initializing dropdowns with search data...");let t=le(n);oe(t),se(),ie(),console.log("Dropdowns initialized successfully")}var E,S=f(()=>{M();E=null});function k(n){A=n,console.log(`Stored ${A.length} results for filtering/sorting`)}function re(n){return!n||n.length===0?A:A.filter(t=>{if(!t.listMetadata||!t.listMetadata.keyword||!t.listMetadata.keyword[0])return!1;let l=t.listMetadata.keyword[0].split(",").map(a=>a.trim());return n.some(a=>l.includes(a))})}function ce(n,t){let e=[...n];switch(t){case"relevance":e.sort((l,a)=>l.rank&&a.rank?l.rank-a.rank:l.score&&a.score?a.score-l.score:0);break;case"date-newest":e.sort((l,a)=>{let o=l.date?new Date(l.date).getTime():0;return(a.date?new Date(a.date).getTime():0)-o});break;case"date-oldest":e.sort((l,a)=>{let o=l.date?new Date(l.date).getTime():0,s=a.date?new Date(a.date).getTime():0;return o-s});break;case"title-az":e.sort((l,a)=>{let o=l.title||"",s=a.title||"";return o.localeCompare(s)});break;case"title-za":e.sort((l,a)=>{let o=l.title||"";return(a.title||"").localeCompare(o)});break;default:break}return e}async function U(){let n=document.querySelector(".aikb-multiselect-container"),t=document.getElementById("owner");if(!t){console.warn("Sort dropdown not found");return}let e=[];n&&n.__multiSelectInstance&&(e=n.__multiSelectInstance.getSelectedValues());let l=t.value||"relevance";console.log(`Applying filters - Work Areas: [${e.join(", ")}], Sort: "${l}"`);let a=re(e);console.log(`After filtering: ${a.length} results`);let o=ce(a,l);console.log(`After sorting: ${o.length} results`);let{renderResults:s}=await Promise.resolve().then(()=>(w(),O));s(o,"search-results-list")}function x(){let n=document.querySelector(".aikb-multiselect-container"),t=document.getElementById("owner");n&&n.addEventListener("multiselect-change",function(){console.log("Work area multi-select changed"),U()}),t&&t.addEventListener("change",function(){console.log(`Sort changed to: ${this.value}`),U()}),console.log("Filter and sort listeners initialized")}var A,v=f(()=>{A=[]});var i,V=f(()=>{w();S();v();i={originalterm:"",filteredterm:"",currentPage:1,defaults:{sourceField:"#search",baseURL:"https://ntgov-search.funnelback.squiz.cloud/s/search.json",collection:"ntgov~sp-ntgc-ai-knowledge-base",defaultQuery:"!FunDoesNotExist:PadreNull",funnelbackParams:{},minChars:3,containerSelector:"#content .inner-page.au-body .container"},noisewords:"a au all am an and any are as at be been but by can cant co com de do eg else etc for from get go had has hasnt have he hence her here hers him his how http https i ie if in is it its la me my nor not now of off on or our ours pm put re she so than that the their them then there these they this those thus to too uk un until up upon us very via was we well were what when where which while who why www you your yours",init:function(n,t,e,l,a=!1){console.log("Init Funnelback Search");let o=new RegExp("[*<>();/&]","gi");n=n.replace(o,""),n!==!1&&n.trim().length>0&&(i.originalterm=n,i.currentPage=1,i.callSearchAPI())},callSearchAPI:function(n,t){n!=null&&(i.originalterm=n),console.log("callSearchAPI called with originalterm:",i.originalterm);let e=document.getElementById("search-results-list");e&&(e.innerHTML='<div class="aikb-loading">Searching...</div>'),i.filterQuery(),console.log("After filterQuery, filteredterm:",i.filteredterm);let l=(i.currentPage-1)*10+1,a=`${i.defaults.baseURL}?collection=${i.defaults.collection}`;if(i.filteredterm&&i.filteredterm.trim().length>0){a+=`&query=${encodeURIComponent(i.filteredterm)}`;let o=new URLSearchParams(window.location.search);o.set("query",i.filteredterm),i.currentPage&&i.currentPage!==1?o.set("page",i.currentPage):o.delete("page");let s=window.location.pathname+(o.toString()?"?"+o.toString():"");window.history.replaceState({},"",s)}else a+=`&s=${encodeURIComponent(i.defaults.defaultQuery)}`;a+=`&num_ranks=10&start_rank=${l}`,console.log("Calling Funnelback API:",a),$.ajax({url:a,dataType:"JSON",type:"GET",success:function(o){i.processResults(o)},error:function(o,s,r){console.warn("Funnelback API error, loading fallback data:",r),$.ajax({url:"src/data/search.json",dataType:"JSON",type:"GET",success:function(d){console.log("Loaded fallback search data"),i.processResults(d)},error:function(){console.error("Failed to load fallback search data"),typeof t=="function"?(console.log("Triggering offline search fallback"),t(new Error("Both API and fallback JSON failed"))):e&&(e.innerHTML="<p>Unable to load search results. Please try again later.</p>")}})}})},filterQuery:function(){if(!i.originalterm||i.originalterm.trim()==="")return i.filteredterm="",!1;let n=i.noisewords.split(" "),t=i.originalterm.trim().split(" ");if(t.length===0)return i.filteredterm="",!1;let e=[];$.each(t,function(o,s){$.inArray(s.toLowerCase(),n)===-1&&e.push(s)});let l=new RegExp("[*<>{}();/&]","gi"),a=e.join(" ");a=a.replace(l,""),i.filteredterm=a},processResults:function(n){let t=n.response&&n.response.resultPacket?n.response.resultPacket.results:[];console.log(`Processing ${t.length} search results`);let e=["https://ntgcentral.nt.gov.au/dev/aikb/configuration/listing/articles/_nocache"],l=t.filter(o=>!e.includes(o.liveUrl));console.log(`After filtering: ${l.length} results (excluded ${t.length-l.length})`);let a=l.map(o=>({title:o.title||"",summary:o.summary||"",listMetadata:o.listMetadata||{},date:o.date||"",liveUrl:o.liveUrl||"",rank:o.rank||0,score:o.score||0}));k(a),b(a),x(),p(a,"search-results-list"),console.log("Funnelback API results rendered (updated from offline/fallback)")}};window.ntgFunnelback=i});var j=L(()=>{var de='div[data-hydration-component="squiz-call-to-action"] a';function q(n=document){n.querySelectorAll(de).forEach(e=>{e.classList.add("ntgc-btn","ntgc-btn--primary")})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>q()):q()});function P(){let n=document.getElementById("search-results-list");if(!n){console.warn("search-results-list container not found on page");return}console.log("Loading initial results (fallback first, then API)..."),fetch("src/data/search.json").then(e=>{if(console.log("Fallback JSON response status:",e.status,e.ok),!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}).then(e=>{console.log("Fallback JSON data loaded successfully:",e),H(e,"fallback")}).catch(e=>{console.error("Error loading fallback search.json:",e),n.innerHTML='<p class="aikb-error">Error loading search data: '+e.message+"</p>"}),fetch("https://ntgov-search.funnelback.squiz.cloud/s/search.json?collection=ntgov~sp-ntgc-ai-knowledge-base&s=!FunDoesNotExist:PadreNull").then(e=>{if(console.log("Funnelback API response status:",e.status,e.ok),!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}).then(e=>{console.log("Funnelback API data loaded successfully, updating results:",e),H(e,"api")}).catch(e=>{console.warn("Funnelback API failed or timed out, keeping fallback data:",e)})}function H(n,t="unknown"){let l=(n.response&&n.response.resultPacket?n.response.resultPacket.results:[]).map(a=>({title:a.title||"",summary:a.summary||"",listMetadata:a.listMetadata||{},date:a.date?new Date(a.date).toLocaleDateString("en-AU",{year:"numeric",month:"long"}):"",liveUrl:a.liveUrl||"",rank:a.rank||0,score:a.score||0}));console.log(`Rendering ${l.length} cards from ${t}`),k(l),window.aikbSearchCache=l,console.log(`Cached ${l.length} results for offline search`),b(l),t==="fallback"&&x(),p(l,"search-results-list")}var T=f(()=>{w();S();v();window.addEventListener("load",function(){console.log("Page load event fired, loading initial results..."),setTimeout(P,200)})});function J(n,t){if(!n||!t||t.length===0)return console.log("Offline search: No keywords or no cached results available"),[];let e=n.toLowerCase().replace(/[^\w\s]/g,"").trim();if(!e)return console.log("Offline search: Keywords empty after normalization"),[];console.log(`Offline search: Searching for "${n}" in ${t.length} cached results`);let l=new RegExp(e,"gi"),o=t.map(s=>{let r=0,d=0,c=0,m=0;if(s.title){let u=s.title.toLowerCase().replace(/[^\w\s]/g,"").match(l);u&&(d=u.length,r+=d*3)}if(s.summary){let u=s.summary.toLowerCase().replace(/[^\w\s]/g,"").match(l);u&&(c=u.length,r+=c*1)}if(s.metadata){let u=s.metadata.toLowerCase().replace(/[^\w\s]/g,"").match(l);u&&(m=u.length,r+=m*2)}return{...s,_offlineScore:r,_offlineMatches:{title:d,summary:c,metadata:m}}}).filter(s=>s._offlineScore>0);return o.sort((s,r)=>r._offlineScore-s._offlineScore),console.log(`Offline search: Found ${o.length} results matching "${n}"`),o.length>0&&(console.log("Offline search: Top results:"),o.slice(0,3).forEach((s,r)=>{console.log(`  ${r+1}. "${s.title}" (score: ${s._offlineScore}, title:${s._offlineMatches.title}, summary:${s._offlineMatches.summary}, metadata:${s._offlineMatches.metadata})`)})),o}function Q(){return window.aikbSearchCache&&Array.isArray(window.aikbSearchCache)?(console.log(`Offline search: Retrieved ${window.aikbSearchCache.length} cached results`),window.aikbSearchCache):(console.log("Offline search: No cached data available"),null)}var I=f(()=>{});var W=L(()=>{T();w();I();v();S();(function(){if(typeof window.$>"u"){console.warn("jQuery not loaded; search form handler disabled");return}let t=window.$("#policy-search-form"),e=window.$("#search");if(t.length===0){console.error("Form #policy-search-form not found");return}function l(){return{query:e.val()||"",area:window.$("#document_type").val()||""}}function a(s){s.preventDefault();let r=l();if(!r.query.trim()){console.log("Empty search - reloading initial results"),P();return}let d=Q();if(d&&d.length>0){console.log("Performing immediate offline search for fast results");let c=J(r.query,d);k(c),b(c),p(c,"search-results-list"),console.log(`Offline search: Displayed ${c.length} results (will update with API results)`)}else{let c=window.$("#search-results-list");c.length>0&&c.html('<div class="aikb-loading">Searching...</div>')}window.ntgFunnelback&&typeof window.ntgFunnelback.callSearchAPI=="function"?(window.ntgFunnelback.originalterm=r.query,window.ntgFunnelback.currentPage=1,window.ntgFunnelback.callSearchAPI(r.query,function(c){if(!d||d.length===0){console.error("Search failed and no cached data available");let m=window.$("#search-results-list");m.length>0&&m.html('<p class="aikb-error">Unable to load search results. Please check your connection and try again.</p>')}else console.log("API failed but offline results already displayed")})):console.error("Funnelback API not initialized")}function o(){e.val(""),console.log("Search cleared - reloading initial results"),P()}t.on("submit",a),window.$("#clear-input").on("click",o),e.on("input",function(){let s=window.$("#clear-input");window.$(this).val().length>0?s.attr("hidden",!1):s.attr("hidden","")}),console.log("Search form handler initialized")})()});var ue=L(()=>{V();var De=F(j());w();var Fe=F(W());T();S();v();I();M()});ue();})();
//# sourceMappingURL=aikb_scripts.min.js.map
