(()=>{var x=Object.create;var P=Object.defineProperty;var L=Object.getOwnPropertyDescriptor;var U=Object.getOwnPropertyNames;var I=Object.getPrototypeOf,T=Object.prototype.hasOwnProperty;var S=(e,n)=>()=>(e&&(n=e(e=0)),n);var f=(e,n)=>()=>(n||e((n={exports:{}}).exports,n),n.exports);var M=(e,n,a,c)=>{if(n&&typeof n=="object"||typeof n=="function")for(let t of U(n))!T.call(e,t)&&t!==a&&P(e,t,{get:()=>n[t],enumerable:!(c=L(n,t))||c.enumerable});return e};var y=(e,n,a)=>(a=e!=null?x(I(e)):{},M(n||!e||!e.__esModule?P(a,"default",{value:e,enumerable:!0}):a,e));function j(e){let n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,function(a){return n[a]})}var r,N=S(()=>{r={originalterm:"",filteredterm:"",currentPage:1,defaults:{sourceField:"#search",endpointURL:"https://ntgov-search.funnelback.squiz.cloud/s/search.json?collection=ntgov~sp-ntgc-ai-knowledge-base&s=!FunDoesNotExist:PadreNull",funnelbackParams:{},minChars:3,containerSelector:"#content .inner-page.au-body .container"},noisewords:"a au all am an and any are as at be been but by can cant co com de do eg else etc for from get go had has hasnt have he hence her here hers him his how http https i ie if in is it its la me my nor not now of off on or our ours pm put re she so than that the their them then there these they this those thus to too uk un until up upon us very via was we well were what when where which while who why www you your yours",init:function(e,n,a,c,t=!1){console.log("Init Funnelback Search");let o=new RegExp("[*<>();/&]","gi");e=e.replace(o,""),e!==!1&&(r.originalterm=e,r.currentPage=1,r.callSearchAPI()),$(".search-icon").on("click",function(){$("#policy-search-form").trigger("submit")}),$("#policy-search-form").on("submit",function(s){s.preventDefault();let l=$(r.defaults.sourceField).val(),d=new RegExp("[*<>();/&]","gi");l=l.replace(d,""),$(r.defaults.sourceField).val(l),r.originalterm=l,r.currentPage=1,r.callSearchAPI()})},callSearchAPI:function(){$(r.defaults.containerSelector).html(""),r.filterQuery();let e=new URLSearchParams(window.location.search).has("query"),n=r.filteredterm&&r.filteredterm.trim().length>0,a=r.currentPage&&r.currentPage!==1;if(n||a||e){let s=new URLSearchParams(window.location.search);n&&s.set("query",r.filteredterm),a?s.set("page",r.currentPage):s.delete("page");let l=window.location.pathname+(s.toString()?"?"+s.toString():"");window.history.replaceState({},"",l)}let c=(r.currentPage-1)*10+1,t=r.defaults.endpointURL;t=t.replace(/start_rank=\d+/,"start_rank="+c);let o=t+"&query="+encodeURIComponent(r.filteredterm)+"&num_ranks=10";console.log("Calling Funnelback API directly:",o),$.ajax({url:o,dataType:"JSON",type:"GET",success:function(s){r.processResults(s)},error:function(s,l,d){console.warn("Funnelback API error, loading fallback data:",d),$.ajax({url:"src/data/search.json",dataType:"JSON",type:"GET",success:function(u){console.log("Loaded fallback search data"),r.processResults(u)},error:function(){console.error("Failed to load fallback search data"),$(r.defaults.containerSelector).html("<p>Unable to load search results. Please try again later.</p>")}})}})},filterQuery:function(){let e=r.noisewords.split(" "),n=r.originalterm.split(" ");if(n.length===0)return r.filteredterm=n,!1;let a=[];$.each(n,function(o,s){$.inArray(s,e)===-1&&a.push(s)});let c=new RegExp("[*<>{}();/&]","gi"),t=a.join(" ");t=t.replace(c,""),r.filteredterm=t},processResults:function(e){let n=e.response&&e.response.resultPacket?e.response.resultPacket.results:[],a=JSON.stringify(n,null,2),c="<pre><code>"+j(a)+"</code></pre>",t=document.getElementById("search-results-list");t?(t.innerHTML=c,console.log("JSON output written to #search-results-list")):(console.warn("#search-results-list container not found, logging results instead"),console.log("Funnelback Results:",n)),console.log("Funnelback Full Response:",e)}};window.ntgFunnelback=r});var F=f(()=>{var q='div[data-hydration-component="squiz-call-to-action"] a';function R(e=document){e.querySelectorAll(q).forEach(a=>{a.classList.add("ntgc-btn","ntgc-btn--primary")})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>R()):R()});function D(e){if(!e)return"";if(/^[A-Z][a-z]+ \d{4}$/.test(e))return e;try{let a=new Date(e);if(!isNaN(a.getTime()))return`${["January","February","March","April","May","June","July","August","September","October","November","December"][a.getMonth()]} ${a.getFullYear()}`}catch{}return e}function J(e){if(!e.title||!e.summary||!e.liveUrl)return console.warn("Skipping card with missing required fields:",e),null;let n=document.createElement("div");n.className="aikb-search-card";let a=document.createElement("div");a.className="aikb-search-card__inner";let c=document.createElement("div");c.className="aikb-search-card__content";let t=document.createElement("div");t.className="aikb-search-card__text";let o=document.createElement("h3");o.className="aikb-search-card__title",o.textContent=e.title,t.appendChild(o);let s=document.createElement("p");s.className="aikb-search-card__summary",s.textContent=e.summary,t.appendChild(s),c.appendChild(t);let l=e.listMetadata&&e.listMetadata.keyword?e.listMetadata.keyword[0]:null;if(l){let i=document.createElement("div");i.className="aikb-search-card__tags",l.split(",").forEach(h=>{let C=h.trim();if(C){let w=document.createElement("div");w.className="aikb-search-card__tag",w.textContent=C,i.appendChild(w)}}),c.appendChild(i)}a.appendChild(c);let d=document.createElement("div");d.className="aikb-search-card__actions";let u=document.createElement("a");u.href=e.liveUrl,u.className="ntgc-btn ntgc-btn--secondary";let E=document.createElement("span");E.textContent="See more",u.appendChild(E);let g=document.createElement("span");g.className="fal fa-long-arrow-right",g.setAttribute("aria-hidden","true"),u.appendChild(g),d.appendChild(u);let m=document.createElement("div");m.className="aikb-search-card__metadata";let v=e.listMetadata&&e.listMetadata.keyword?e.listMetadata.keyword[1]:null;if(v){let i=document.createElement("div");i.className="aikb-search-card__useful-for";let p=document.createElement("span");p.className="aikb-search-card__useful-label",p.textContent="Useful for: ",i.appendChild(p);let h=document.createElement("span");h.className="aikb-search-card__useful-value",h.textContent=v,i.appendChild(h),m.appendChild(i)}if(e.date){let i=document.createElement("div");i.className="aikb-search-card__date",i.textContent=`Submitted: ${D(e.date)}`,m.appendChild(i)}return d.appendChild(m),a.appendChild(d),n.appendChild(a),n}function b(e,n="search-results-list"){console.log(`renderResults called with ${e.length} results for container #${n}`);let a=document.getElementById(n);if(console.log(`document.getElementById("${n}"):`,a),!a){let t=window.$?window.$(`#${n}`):null;console.log(`jQuery selector $("#${n}"):`,t),a=t&&t.length>0?t[0]:null}if(!a){console.error(`Container #${n} not found`),console.log("Available elements with id:",Array.from(document.querySelectorAll("[id]")).map(t=>t.id));return}a.innerHTML="";let c=e.map(t=>J(t)).filter(t=>t!==null);if(c.length===0){let t=document.createElement("p");t.textContent="No results found.",t.style.padding="24px 48px",a.appendChild(t);return}c.forEach(t=>a.appendChild(t)),console.log(`Rendered ${c.length} search result cards`)}var k=S(()=>{window.aikbRenderResults=b});var _=f(()=>{(function(){if(typeof window.$>"u"){console.warn("jQuery not loaded; search form handler disabled");return}let n=window.$("#policy-search-form"),a=window.$("#search");if(n.length===0){console.error("Form #policy-search-form not found");return}function c(){return{query:a.val()||"",area:window.$("#select-input-2").val()||""}}function t(s){s.preventDefault();let l=c();if(!l.query.trim()){console.warn("Search query is empty");return}let d=window.$("#search-results-list");d.length>0&&d.html('<div class="aikb-loading">Searching...</div>'),window.ntgFunnelback&&typeof window.ntgFunnelback.callSearchAPI=="function"?window.ntgFunnelback.callSearchAPI(l.query,l):console.error("Funnelback API not initialized")}function o(){a.val("");let s=window.$("#search-results-list");s.length>0&&s.html("")}n.on("submit",t),window.$("#clear-input").on("click",o),a.on("input",function(){let s=window.$("#clear-input");window.$(this).val().length>0?s.attr("hidden",!1):s.attr("hidden","")}),console.log("Search form handler initialized")})()});var A=f(()=>{k();(function(){function e(){let a=document.getElementById("search-results-list");if(!a){console.warn("search-results-list container not found on page");return}console.log("Loading initial results from Funnelback API..."),fetch("https://ntgov-search.funnelback.squiz.cloud/s/search.json?collection=ntgov~sp-ntgc-ai-knowledge-base&s=!FunDoesNotExist:PadreNull&query=").then(t=>{if(console.log("Funnelback API response status:",t.status,t.ok),!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return t.json()}).then(t=>{console.log("Funnelback API data loaded successfully:",t),n(t)}).catch(t=>{console.error("Error loading from Funnelback API, falling back to local JSON:",t),fetch("src/data/search.json").then(o=>{if(console.log("Fallback JSON response status:",o.status,o.ok),!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return o.json()}).then(o=>{console.log("Fallback JSON data loaded successfully:",o),n(o)}).catch(o=>{console.error("Error loading fallback search.json:",o),a.innerHTML="<p>Error loading search data: "+o.message+"</p>"})})}function n(a){let t=(a.response&&a.response.resultPacket?a.response.resultPacket.results:[]).map(o=>({title:o.title||"",summary:o.summary||"",listMetadata:o.listMetadata||{},date:o.date?new Date(o.date).toLocaleDateString("en-AU",{year:"numeric",month:"long"}):"",liveUrl:o.liveUrl||""}));console.log("Rendering",t.length,"cards"),b(t,"search-results-list")}window.addEventListener("load",function(){console.log("Page load event fired, loading initial results..."),setTimeout(e,200)})})()});var O=f(()=>{N();var ee=y(F());k();var ne=y(_()),ae=y(A())});O();})();
//# sourceMappingURL=aikb_scripts.min.js.map
